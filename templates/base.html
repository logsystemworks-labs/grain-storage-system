<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Log SystemWorks{% endblock %}</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

    <link href="../static/css/login.css" rel="stylesheet">

    {% block extra_css %}{% endblock %}
</head>
<body>

<!-- SIDEBAR -->
<nav id="sidebar">
    <!-- Logo -->
    <div class="logo d-flex align-items-center gap-2">
        <i class="bi bi-boxes text-warning fs-4"></i>
        <span>Log System Works</span>
    </div>

    <!-- Nav -->
    <ul class="nav flex-column mt-3">

        <li class="nav-section">Principal</li>

        <li class="nav-item">
            <a href="{{ url_for('dashboard.index') }}"
               class="nav-link {% if request.endpoint == 'dashboard.index' %}active{% endif %}">
                <i class="bi bi-grid-1x2"></i> Dashboard
            </a>
        </li>

        <li class="nav-section">Armazenagem</li>

        <li class="nav-item">
            <a href="{{ url_for('silos.index') }}"
               class="nav-link {% if 'silos' in request.endpoint %}active{% endif %}">
                <i class="bi bi-building"></i> Silos
            </a>
        </li>

        <li class="nav-item">
            <a href="{{ url_for('movimentos.entrada') }}"
               class="nav-link {% if 'movimentos' in request.endpoint %}active{% endif %}">
                <i class="bi bi-arrow-left-right"></i> Movimentos
            </a>
        </li>

        <li class="nav-item">
            <a href="{{ url_for('relatorios.index') }}"
               class="nav-link {% if 'relatorios' in request.endpoint %}active{% endif %}">
                <i class="bi bi-bar-chart-line"></i> Relatórios
            </a>
        </li>

        <li class="nav-section">Sistema</li>

        <li class="nav-item">
            <a href="{{ url_for('auth.perfil') }}"
               class="nav-link {% if 'perfil' in request.endpoint %}active{% endif %}">
                <i class="bi bi-person-circle"></i> Perfil
            </a>
        </li>

        <li class="nav-item">
            <a href="{{ url_for('auth.logout') }}" class="nav-link text-danger-emphasis">
                <i class="bi bi-box-arrow-left"></i> Sair
            </a>
        </li>

    </ul>

    <!-- Usuário logado no rodapé da sidebar -->
    <div class="position-absolute bottom-0 w-100 p-3"
         style="border-top: 1px solid rgba(255,255,255,0.1);">
        <div class="d-flex align-items-center gap-2">
            <div class="rounded-circle bg-warning d-flex align-items-center justify-content-center"
                 style="width:32px; height:32px;">
                <i class="bi bi-person-fill text-dark" style="font-size:0.85rem;"></i>
            </div>
            <div>
                <div class="text-white" style="font-size:0.8rem; font-weight:600;">
                    {{ current_user.username }}
                </div>
                <div style="font-size:0.7rem; color:rgba(255,255,255,0.5);">
                    {{ current_user.safe.name if current_user.safe else 'Admin' }}
                </div>
            </div>
        </div>
    </div>
</nav>


<!-- MAIN -->
<div id="main">

    <!-- Topbar -->
    <div id="topbar">
        <!-- Botão toggle mobile -->
        <button class="btn btn-sm btn-light d-md-none" id="sidebarToggle">
            <i class="bi bi-list fs-5"></i>
        </button>

        <!-- Título da página -->
        <h6 class="mb-0 fw-semibold text-muted">
            {% block page_title %}{% endblock %}
        </h6>

        <!-- Direita: notificações + user -->
        <div class="d-flex align-items-center gap-3">

            <!-- Notificações -->
            <div class="position-relative">
                <button class="btn btn-sm btn-light position-relative">
                    <i class="bi bi-bell"></i>
                    {% if notificacoes %}
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                          style="font-size:0.6rem;">
                        {{ notificacoes|length }}
                    </span>
                    {% endif %}
                </button>
            </div>

            <!-- Nome do usuário -->
            <span class="text-muted" style="font-size:0.85rem;">
                Olá, <strong>{{ current_user.username }}</strong>
            </span>
        </div>
    </div>

    <!-- Conteúdo da página -->
    <div class="p-4">

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                    <i class="bi bi-{{ 'check-circle' if category == 'success'else 'exclamation-triangle' if category == 'warning'else 'x-circle' }} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Bloco principal -->
        {% block content %}{% endblock %}

    </div>
</div>


<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Toggle sidebar no mobile
    document.getElementById('sidebarToggle')?.addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('show')
    })
</script>

{% block extra_js %}{% endblock %}

</body>
</html>